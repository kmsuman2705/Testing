<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Score Update</title>
    <style>
        /* Basic styling */
        body { font-family: Arial, sans-serif; margin: 20px; }
        input, select { margin: 5px 0; padding: 5px; width: 100%; max-width: 200px; }
        label { display: block; margin-top: 10px; }
        button { margin-top: 20px; padding: 10px 20px; }
        .container { max-width: 600px; margin: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Update Score</h2>
        <form id="scoreForm">
            <!-- Team Names -->
            <label>Team A Name:
                <input type="text" id="teamA" required />
            </label>
            <label>Team B Name:
                <input type="text" id="teamB" required />
            </label>

            <!-- Score Inputs -->
            <label>Total Runs:
                <input type="number" id="runs" min="0" required />
            </label>
            <label>Wickets:
                <input type="number" id="wickets" min="0" max="10" required />
            </label>
            <label>Overs (format 10.3 means 10 overs 3 balls):
                <input type="text" id="overs" pattern="^\d+(\.\d)?$" title="Format: number.number (e.g., 10.3)" required />
            </label>

            <!-- Last 6 balls -->
            <label>Last 6 Balls (space separated):
                <input type="text" id="last6" placeholder="e.g., 1 0 W 4 NB 6" />
            </label>

            <!-- Batsman 1 -->
            <fieldset>
                <legend>Batsman 1</legend>
                <label>Name:
                    <input type="text" id="batsman1Name" required />
                </label>
                <label>Runs:
                    <input type="number" id="batsman1Runs" min="0" required />
                </label>
                <label>Balls:
                    <input type="number" id="batsman1Balls" min="0" required />
                </label>
                <label>Fours:
                    <input type="number" id="batsman1Fours" min="0" required />
                </label>
                <label>Sixes:
                    <input type="number" id="batsman1Sixes" min="0" required />
                </label>
                <label>Strike Rate:
                    <input type="number" step="0.1" id="batsman1Sr" readonly />
                </label>
            </fieldset>

            <!-- Batsman 2 -->
            <fieldset>
                <legend>Batsman 2</legend>
                <label>Name:
                    <input type="text" id="batsman2Name" required />
                </label>
                <label>Runs:
                    <input type="number" id="batsman2Runs" min="0" required />
                </label>
                <label>Balls:
                    <input type="number" id="batsman2Balls" min="0" required />
                </label>
                <label>Fours:
                    <input type="number" id="batsman2Fours" min="0" required />
                </label>
                <label>Sixes:
                    <input type="number" id="batsman2Sixes" min="0" required />
                </label>
                <label>Strike Rate:
                    <input type="number" step="0.1" id="batsman2Sr" readonly />
                </label>
            </fieldset>

            <!-- Bowler -->
            <fieldset>
                <legend>Bowler</legend>
                <label>Name:
                    <input type="text" id="bowlerName" required />
                </label>
                <label>Overs (format 4.3 means 4 overs and 3 balls):
                    <input type="text" id="bowlerOvers" pattern="^\d+(\.\d)?$" title="Format: number.number (e.g., 4.3)" required />
                </label>
                <label>Runs Given:
                    <input type="number" id="bowlerRuns" min="0" required />
                </label>
                <label>Wickets:
                    <input type="number" id="bowlerWickets" min="0" max="10" required />
                </label>
                <label>Economy Rate:
                    <input type="number" step="0.01" id="bowlerEco" readonly />
                </label>
            </fieldset>

            <!-- Target -->
            <label>Target Runs (if chase):
                <input type="number" id="target" min="0" />
            </label>
            <label>Target Wickets (if chase):
                <input type="number" id="targetWickets" min="0" max="10" />
            </label>
            <label>Target Overs (if chase):
                <input type="number" id="targetOvers" min="0" />
            </label>

            <!-- Current Run Rate and Required Run Rate -->
            <label>Current Run Rate:
                <input type="number" step="0.01" id="crr" readonly />
            </label>
            <label>Required Run Rate:
                <input type="number" step="0.01" id="rrr" readonly />
            </label>

            <button type="submit">Update Score</button>
        </form>

        <div id="message"></div>
    </div>

    <script>
        function calculateStrikeRate(runs, balls) {
            return balls > 0 ? ((runs / balls) * 100).toFixed(1) : 0.0;
        }

        function calculateEconomy(runs, overs) {
            if (!overs) return 0.0;
            const parts = overs.split('.');
            const fullOvers = parseInt(parts[0]) || 0;
            const balls = parseInt(parts[1]) || 0;
            const totalOvers = fullOvers + balls / 6;
            return totalOvers > 0 ? (runs / totalOvers).toFixed(2) : 0.0;
        }

        function calculateCRR(runs, overs) {
            if (!overs) return 0.0;
            const parts = overs.split('.');
            const fullOvers = parseInt(parts[0]) || 0;
            const balls = parseInt(parts[1]) || 0;
            const totalOvers = fullOvers + balls / 6;
            return totalOvers > 0 ? (runs / totalOvers).toFixed(2) : 0.0;
        }

        function calculateRRR(runs, target, overs, targetOvers) {
            if (!target || !targetOvers || !overs) return null;
            const parts = overs.split('.');
            const fullOvers = parseInt(parts[0]) || 0;
            const balls = parseInt(parts[1]) || 0;
            const ballsBowled = fullOvers * 6 + balls;

            const totalBalls = targetOvers * 6;
            const ballsLeft = totalBalls - ballsBowled;
            const runsLeft = target - runs + 1;

            if (ballsLeft <= 0) return 0.0;
            return (runsLeft / (ballsLeft / 6)).toFixed(2);
        }

        document.getElementById('scoreForm').addEventListener('submit', function (e) {
            e.preventDefault();

            // Gather inputs
            const teamA = document.getElementById('teamA').value.trim();
            const teamB = document.getElementById('teamB').value.trim();
            const runs = parseInt(document.getElementById('runs').value) || 0;
            const wickets = parseInt(document.getElementById('wickets').value) || 0;
            const overs = document.getElementById('overs').value.trim();
            const last6 = document.getElementById('last6').value.trim();

            // Batsman 1
            const batsman1Name = document.getElementById('batsman1Name').value.trim();
            const batsman1Runs = parseInt(document.getElementById('batsman1Runs').value) || 0;
            const batsman1Balls = parseInt(document.getElementById('batsman1Balls').value) || 0;
            const batsman1Fours = parseInt(document.getElementById('batsman1Fours').value) || 0;
            const batsman1Sixes = parseInt(document.getElementById('batsman1Sixes').value) || 0;

            // Batsman 2
            const batsman2Name = document.getElementById('batsman2Name').value.trim();
            const batsman2Runs = parseInt(document.getElementById('batsman2Runs').value) || 0;
            const batsman2Balls = parseInt(document.getElementById('batsman2Balls').value) || 0;
            const batsman2Fours = parseInt(document.getElementById('batsman2Fours').value) || 0;
            const batsman2Sixes = parseInt(document.getElementById('batsman2Sixes').value) || 0;

            // Bowler
            const bowlerName = document.getElementById('bowlerName').value.trim();
            const bowlerOvers = document.getElementById('bowlerOvers').value.trim();
            const bowlerRuns = parseInt(document.getElementById('bowlerRuns').value) || 0;
            const bowlerWickets = parseInt(document.getElementById('bowlerWickets').value) || 0;

            // Target
            const target = parseInt(document.getElementById('target').value) || null;
            const targetWickets = parseInt(document.getElementById('targetWickets').value) || null;
            const targetOvers = parseInt(document.getElementById('targetOvers').value) || null;

            // Calculate strike rates
            const batsman1Sr = calculateStrikeRate(batsman1Runs, batsman1Balls);
            const batsman2Sr = calculateStrikeRate(batsman2Runs, batsman2Balls);
            document.getElementById('batsman1Sr').value = batsman1Sr;
            document.getElementById('batsman2Sr').value = batsman2Sr;

            // Calculate economy
            const bowlerEco = calculateEconomy(bowlerRuns, bowlerOvers);
            document.getElementById('bowlerEco').value = bowlerEco;

            // Calculate CRR and RRR
            const crr = calculateCRR(runs, overs);
            const rrr = calculateRRR(runs, target, overs, targetOvers);
            document.getElementById('crr').value = crr;
            document.getElementById('rrr').value = rrr !== null ? rrr : '';

            // Prepare data object
            const scoreData = {
                teamA,
                teamB,
                runs,
                wickets,
                overs,
                last6,
                batsman1: {
                    name: batsman1Name,
                    runs: batsman1Runs,
                    balls: batsman1Balls,
                    fours: batsman1Fours,
                    sixes: batsman1Sixes,
                    sr: parseFloat(batsman1Sr)
                },
                batsman2: {
                    name: batsman2Name,
                    runs: batsman2Runs,
                    balls: batsman2Balls,
                    fours: batsman2Fours,
                    sixes: batsman2Sixes,
                    sr: parseFloat(batsman2Sr)
                },
                bowler: {
                    name: bowlerName,
                    overs: bowlerOvers,
                    runs: bowlerRuns,
                    wickets: bowlerWickets,
                    eco: parseFloat(bowlerEco)
                },
                target,
                targetWickets,
                targetOvers,
                crr: parseFloat(crr),
                rrr: rrr !== null ? parseFloat(rrr) : null
            };

            fetch('update.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ score: scoreData })
            })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('message').textContent = 'Score updated successfully!';
                    } else {
                        document.getElementById('message').textContent = 'Error: ' + data.message;
                    }
                })
                .catch(err => {
                    document.getElementById('message').textContent = 'Fetch error: ' + err.message;
                });
        });
    </script>
</body>
</html>
