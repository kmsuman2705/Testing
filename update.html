<!DOCTYPE html>
<html>
<head>
  <title>Update Live Score</title>
  <meta charset="UTF-8">
  <style>
    body { background:#001f3f; font-family:Arial,sans-serif; color:#fff; padding:10px; }
    table { border-collapse:collapse; width:100%; margin-bottom:10px; }
    th, td { border:1px solid #444; padding:5px; text-align:center; }
    input, select { width:80px; padding:4px; text-align:center; }
    button { padding:6px 10px; margin:4px; border:none; border-radius:5px; cursor:pointer; background:#0074D9; color:#fff; font-weight:bold; }
    button:hover { background:#005fa3; }
    .swap-btn { background:#FF851B; }
    .next-btn { background:#2ECC40; }
    h3 { margin-top:20px; }
    .last6-display { display:flex; justify-content:center; gap:5px; margin-top:5px; }
    .last6-ball { width:28px; height:28px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; }
    .ball-0 { background:#666; color:#fff; }
    .ball-1, .ball-2, .ball-3 { background:#00aa66; color:#fff; }
    .ball-4 { background:green; color:#fff; }
    .ball-6 { background:blue; color:#fff; }
    .ball-W { background:red; color:#fff; }
    .ball-extra { background:yellow; color:#000; }
  </style>
</head>
<body>
<h2>Update Live Score</h2>

<!-- Match Info -->
<table>
<tr>
  <th>Team A</th><th>Team B</th><th>Runs</th><th>Wickets</th><th>Overs</th>
  <th>Target</th><th>Target Overs</th><th>Target Wkts</th><th>Last 6 Balls</th>
</tr>
<tr>
  <td><input id="teamA"></td>
  <td><input id="teamB"></td>
  <td><input type="number" id="runs" value="0"></td>
  <td><input type="number" id="wickets" value="0"></td>
  <td><input id="overs" value="0.0"></td>
  <td><input type="number" id="target" placeholder="e.g. 250"></td>
  <td><input type="number" id="targetOvers" placeholder="e.g. 50"></td>
  <td><input type="number" id="targetWickets" placeholder="e.g. 10"></td>
  <td>
    <div class="last6-display" id="last6Container"></div>
    <input type="hidden" id="last6">
  </td>
</tr>
</table>

<!-- Batsmen Info -->
<table>
<tr>
  <th colspan="6">Batsman 1</th>
  <th colspan="6">Batsman 2</th>
</tr>
<tr>
  <td>Name</td><td>R</td><td>B</td><td>4s</td><td>6s</td><td>SR</td>
  <td>Name</td><td>R</td><td>B</td><td>4s</td><td>6s</td><td>SR</td>
</tr>
<tr>
  <td><input id="b1Name" type="text"></td><td><input id="b1Runs" type="number" value="0"></td>
  <td><input id="b1Balls" type="number" value="0"></td><td><input id="b1Fours" type="number" value="0"></td>
  <td><input id="b1Sixes" type="number" value="0"></td><td><input id="b1SR" readonly></td>

  <td><input id="b2Name" type="text"></td><td><input id="b2Runs" type="number" value="0"></td>
  <td><input id="b2Balls" type="number" value="0"></td><td><input id="b2Fours" type="number" value="0"></td>
  <td><input id="b2Sixes" type="number" value="0"></td><td><input id="b2SR" readonly></td>
</tr>
</table>

<!-- Bowler -->
<table>
<tr><th>Name</th><th>Overs</th><th>Runs</th><th>Wkts</th><th>ECO</th></tr>
<tr>
  <td><input id="bowlerName" type="text"></td>
  <td><input id="bowlerOvers" value="0.0"></td>
  <td><input type="number" id="bowlerRuns" value="0"></td>
  <td><input type="number" id="bowlerWickets" value="0"></td>
  <td><input id="bowlerEco" readonly></td>
</tr>
</table>

<!-- Buttons -->
<button class="swap-btn" onclick="swapBatsmen()">Swap Batsmen</button>
<button class="next-btn" onclick="nextBatsman(1)">Next Batsman 1</button>
<button class="next-btn" onclick="nextBatsman(2)">Next Batsman 2</button>
<button onclick="saveData()">Save Score</button>

<h3>Quick Update - Last Ball</h3>
<select id="lastBall">
  <option value="">Select Ball</option>
  <option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option>
  <option value="4">4</option><option value="6">6</option><option value="W">Wicket</option>
  <option value="WD">WD+0</option><option value="WD1">WD+1</option><option value="WD2">WD+2</option><option value="WD3">WD+3</option><option value="WD4">WD+4</option>
  <option value="NB">NB+0</option><option value="NB1">NB+1</option><option value="NB2">NB+2</option><option value="NB3">NB+3</option><option value="NB4">NB+4</option><option value="NB6">NB+6</option>
  <option value="LB1">Leg Bye 1</option><option value="LB2">Leg Bye 2</option>
</select>
<button onclick="addLastBall()">Add Last Ball</button>

<p id="status"></p>

<script>
let last6Balls = [];

// Helper functions
function calcSR(r, b) {
  return b > 0 ? ((r / b) * 100).toFixed(1) : "0.0";
}
function calcECO(r, o) {
  let parts = o.split(".");
  let total = parseInt(parts[0]) + ((parseInt(parts[1] || 0)) / 6);
  return total > 0 ? (r / total).toFixed(2) : "0.0";
}

function autoCalc() {
  document.getElementById('b1SR').value = calcSR(+document.getElementById('b1Runs').value, +document.getElementById('b1Balls').value);
  document.getElementById('b2SR').value = calcSR(+document.getElementById('b2Runs').value, +document.getElementById('b2Balls').value);
  document.getElementById('bowlerEco').value = calcECO(+document.getElementById('bowlerRuns').value, document.getElementById('bowlerOvers').value);
}

function swapBatsmen() {
  const ids = ["Name", "Runs", "Balls", "Fours", "Sixes", "SR"];
  let temp = {};
  ids.forEach(f => temp[f] = document.getElementById("b1" + f).value);
  ids.forEach(f => document.getElementById("b1" + f).value = document.getElementById("b2" + f).value);
  ids.forEach(f => document.getElementById("b2" + f).value = temp[f]);
}

function nextBatsman(num) {
  document.getElementById(`b${num}Name`).value = "";
  document.getElementById(`b${num}Runs`).value = 0;
  document.getElementById(`b${num}Balls`).value = 0;
  document.getElementById(`b${num}Fours`).value = 0;
  document.getElementById(`b${num}Sixes`).value = 0;
  document.getElementById(`b${num}SR`).value = "0.0";
}

function incrementOvers(current) {
  let [o, b] = current.split(".").map(x => parseInt(x || 0));
  b++;
  if (b >= 6) { o++; b = 0; }
  return `${o}.${b}`;
}

function updateLast6Display() {
  const container = document.getElementById('last6Container');
  container.innerHTML = "";
  last6Balls.forEach(b => {
    let span = document.createElement('div');
    span.classList.add('last6-ball');
    if (b === '0') span.classList.add('ball-0');
    else if (['1','2','3'].includes(b)) span.classList.add('ball-1');
    else if (b === '4') span.classList.add('ball-4');
    else if (b === '6') span.classList.add('ball-6');
    else if (b === 'W') span.classList.add('ball-W');
    else span.classList.add('ball-extra');
    span.innerText = b;
    container.appendChild(span);
  });
}

function addLastBall() {
  const lastBallSelect = document.getElementById('lastBall');
  let val = lastBallSelect.value;
  if (!val) return;
  last6Balls.push(val);
  if (last6Balls.length > 6) last6Balls.shift();
  document.getElementById('last6').value = last6Balls.join(" ");
  updateLast6Display();

  let striker = "b1";

  if (val.startsWith("WD")) {
    let extra = val.length > 2 ? parseInt(val.slice(2)) : 0;
    document.getElementById('runs').value = +document.getElementById('runs').value + 1 + extra;
    if (extra % 2 === 1) swapBatsmen();
  }
  else if (val.startsWith("NB")) {
    let extra = val.length > 2 ? parseInt(val.slice(2)) : 0;
    document.getElementById('runs').value = +document.getElementById('runs').value + 1 + extra;
    if (extra > 0) {
      let rEl = document.getElementById(striker + "Runs");
      let bEl = document.getElementById(striker + "Balls");
      rEl.value = +rEl.value + extra;
      bEl.value = +bEl.value + 1;
    }
    if (extra % 2 === 1) swapBatsmen();
  }
  else if (val === "W") {
    document.getElementById('wickets').value = +document.getElementById('wickets').value + 1;
    let bEl = document.getElementById(striker + "Balls");
    bEl.value = +bEl.value + 1;
    nextBatsman(striker === "b1" ? 1 : 2);
    document.getElementById('overs').value = incrementOvers(document.getElementById('overs').value);
  }
  else if (["0","1","2","3","4","6"].includes(val)) {
    document.getElementById('runs').value = +document.getElementById('runs').value + +val;
    let rEl = document.getElementById(striker + "Runs");
    let bEl = document.getElementById(striker + "Balls");
    rEl.value = +rEl.value + +val;
    bEl.value = +bEl.value + 1;
    if (val === "4") document.getElementById(striker + "Fours").value = +document.getElementById(striker + "Fours").value + 1;
    if (val === "6") document.getElementById(striker + "Sixes").value = +document.getElementById(striker + "Sixes").value + 1;
    if ([1,3].includes(+val)) swapBatsmen();
    document.getElementById('overs').value = incrementOvers(document.getElementById('overs').value);
  }
  else if (val.startsWith("LB")) {
    let lb = parseInt(val.slice(2));
    document.getElementById('runs').value = +document.getElementById('runs').value + lb;
    let bEl = document.getElementById(striker + "Balls");
    bEl.value = +bEl.value + 1;
    if (lb % 2 === 1) swapBatsmen();
    document.getElementById('overs').value = incrementOvers(document.getElementById('overs').value);
  }

  autoCalc();
  saveData();
}

async function saveData(){
  autoCalc();
  let payload = {
    score:{
      teamA: document.getElementById('teamA').value,
      teamB: document.getElementById('teamB').value,
      runs: +document.getElementById('runs').value,
      wickets: +document.getElementById('wickets').value,
      overs: document.getElementById('overs').value,
      target: document.getElementById('target').value ? +document.getElementById('target').value : null,
      targetOvers: document.getElementById('targetOvers').value ? +document.getElementById('targetOvers').value : null,
      targetWickets: document.getElementById('targetWickets').value ? +document.getElementById('targetWickets').value : null,
      last6: document.getElementById('last6').value,
      batsman1:{
        name: document.getElementById('b1Name').value,
        runs: +document.getElementById('b1Runs').value,
        balls: +document.getElementById('b1Balls').value,
        fours: +document.getElementById('b1Fours').value,
        sixes: +document.getElementById('b1Sixes').value,
        sr: document.getElementById('b1SR').value
      },
      batsman2:{
        name: document.getElementById('b2Name').value,
        runs: +document.getElementById('b2Runs').value,
        balls: +document.getElementById('b2Balls').value,
        fours: +document.getElementById('b2Fours').value,
        sixes: +document.getElementById('b2Sixes').value,
        sr: document.getElementById('b2SR').value
      },
      bowler:{
        name: document.getElementById('bowlerName').value,
        overs: document.getElementById('bowlerOvers').value,
        runs: +document.getElementById('bowlerRuns').value,
        wickets: +document.getElementById('bowlerWickets').value,
        eco: document.getElementById('bowlerEco').value
      }
    }
  };

  try {
    let res = await fetch("update.php", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(payload)
    });
    let result = await res.json();
    document.getElementById('status').innerText = result.success ? "✅ Score Updated!" : "❌ Error: " + (result.message || "Unknown");
  } catch (e) {
    document.getElementById('status').innerText = "❌ Error!";
    console.error(e);
  }
}

document.querySelectorAll("input").forEach(inp => inp.addEventListener("input", autoCalc));
</script>
</body>
</html>

