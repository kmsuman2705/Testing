<!-- START OF update.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Update Live Score</title>
  <meta charset="UTF-8">
  <style>
    body { background:#001f3f; font-family:Arial,sans-serif; color:#fff; padding:10px; }
    table { border-collapse:collapse; width:100%; margin-bottom:10px; }
    th, td { border:1px solid #444; padding:5px; text-align:center; }
    input, select { width:80px; padding:4px; text-align:center; }
    button { padding:6px 10px; margin:4px; border:none; border-radius:5px; cursor:pointer; background:#0074D9; color:#fff; font-weight:bold; }
    button:hover { background:#005fa3; }
    .swap-btn { background:#FF851B; }
    .next-btn { background:#2ECC40; }
    h3 { margin-top:20px; }
    .last6-display { display:flex; justify-content:center; gap:5px; margin-top:5px; }
    .last6-ball { width:28px; height:28px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; }
    .ball-0 { background:#666; color:#fff; }
    .ball-1, .ball-2, .ball-3 { background:#00aa66; color:#fff; }
    .ball-4 { background:green; color:#fff; }
    .ball-6 { background:blue; color:#fff; }
    .ball-W { background:red; color:#fff; }
    .ball-extra { background:yellow; color:#000; }
  </style>
</head>
<body>
<h2>Update Live Score</h2>

<!-- Rest of your HTML inputs remain unchanged, I am skipping them here for brevity -->
<!-- We're focusing on fixing JS inside <script> below -->

<script>
let last6Balls = [];

function calcSR(r, b) {
  return b > 0 ? ((r / b) * 100).toFixed(1) : "0.0";
}

function calcECO(r, o) {
  let p = o.split(".");
  let t = parseInt(p[0]) + ((parseInt(p[1] || 0)) / 6);
  return t > 0 ? (r / t).toFixed(2) : "0.0";
}

function autoCalc() {
  document.getElementById('b1SR').value = calcSR(+document.getElementById('b1Runs').value, +document.getElementById('b1Balls').value);
  document.getElementById('b2SR').value = calcSR(+document.getElementById('b2Runs').value, +document.getElementById('b2Balls').value);
  document.getElementById('bowlerEco').value = calcECO(+document.getElementById('bowlerRuns').value, document.getElementById('bowlerOvers').value);
}

function incrementOvers(current) {
  let [o, b] = current.split(".").map(x => parseInt(x || 0));
  b++; if (b >= 6) { o++; b = 0; }
  return `${o}.${b}`;
}

function swapBatsmen() {
  const ids = ["Name", "Runs", "Balls", "Fours", "Sixes", "SR"];
  let temp = {};
  ids.forEach(f => temp[f] = document.getElementById("b1" + f).value);
  ids.forEach(f => document.getElementById("b1" + f).value = document.getElementById("b2" + f).value);
  ids.forEach(f => document.getElementById("b2" + f).value = temp[f]);
}

function nextBatsman(num) {
  ["Name", "Runs", "Balls", "Fours", "Sixes", "SR"].forEach(f => {
    document.getElementById(`b${num}${f}`).value = (f === "Name" ? "" : 0);
    if (f === "SR") document.getElementById(`b${num}${f}`).value = "0.0";
  });
}

function updateLast6Display() {
  const container = document.getElementById('last6Container');
  container.innerHTML = "";
  last6Balls.forEach(b => {
    let span = document.createElement('div'); span.classList.add('last6-ball');
    if (b === '0') span.classList.add('ball-0');
    else if (['1', '2', '3'].includes(b)) span.classList.add('ball-1');
    else if (b === '4') span.classList.add('ball-4');
    else if (b === '6') span.classList.add('ball-6');
    else if (b === 'W') span.classList.add('ball-W');
    else span.classList.add('ball-extra');
    span.innerText = b;
    container.appendChild(span);
  });
}

function addLastBall() {
  const val = document.getElementById('lastBall').value;
  if (!val) return;

  last6Balls.push(val);
  if (last6Balls.length > 6) last6Balls.shift();
  document.getElementById('last6').value = last6Balls.join(" ");
  updateLast6Display();

  let striker = "b1";
  let batsmanRuns = document.getElementById(striker + "Runs");
  let batsmanBalls = document.getElementById(striker + "Balls");
  let batsmanFours = document.getElementById(striker + "Fours");
  let batsmanSixes = document.getElementById(striker + "Sixes");

  let bowlerRunsEl = document.getElementById('bowlerRuns');
  let bowlerOversEl = document.getElementById('bowlerOvers');
  let bowlerWktsEl = document.getElementById('bowlerWickets');
  let battingOversEl = document.getElementById('overs');

  // Handle No Ball
  if (val.startsWith("NB")) {
    let extra = val.length > 2 ? parseInt(val.slice(2)) : 0;
    document.getElementById('runs').value = +document.getElementById('runs').value + 1 + extra;
    bowlerRunsEl.value = +bowlerRunsEl.value + 1 + extra;
    if (extra > 0) {
      batsmanRuns.value = +batsmanRuns.value + extra;
      batsmanBalls.value++;
      if (extra === 4) batsmanFours.value++;
      if (extra === 6) batsmanSixes.value++;
      if (extra % 2 === 1) swapBatsmen();
    }
    autoCalc();
    saveData();
    return;
  }

  // Wide
  if (val.startsWith("WD")) {
    let extra = val.length > 2 ? parseInt(val.slice(2)) : 0;
    document.getElementById('runs').value = +document.getElementById('runs').value + 1 + extra;
    bowlerRunsEl.value = +bowlerRunsEl.value + 1 + extra;
    if (extra % 2 === 1) swapBatsmen();
    autoCalc();
    saveData();
    return;
  }

  // Wicket
  if (val === "W") {
    document.getElementById('wickets').value++;
    bowlerWktsEl.value++;
    batsmanBalls.value++;
    battingOversEl.value = incrementOvers(battingOversEl.value);
    bowlerOversEl.value = incrementOvers(bowlerOversEl.value);
    autoCalc();
    saveData();
    return;
  }

  // Leg Byes
  if (val.startsWith("LB")) {
    let extra = parseInt(val.slice(2));
    document.getElementById('runs').value = +document.getElementById('runs').value + extra;
    battingOversEl.value = incrementOvers(battingOversEl.value);
    bowlerOversEl.value = incrementOvers(bowlerOversEl.value);
    if (extra % 2 === 1) swapBatsmen();
    autoCalc();
    saveData();
    return;
  }

  // Normal Runs
  let run = parseInt(val);
  document.getElementById('runs').value = +document.getElementById('runs').value + run;
  batsmanRuns.value = +batsmanRuns.value + run;
  batsmanBalls.value++;
  if (run === 4) batsmanFours.value++;
  if (run === 6) batsmanSixes.value++;
  bowlerRunsEl.value = +bowlerRunsEl.value + run;
  battingOversEl.value = incrementOvers(battingOversEl.value);
  bowlerOversEl.value = incrementOvers(bowlerOversEl.value);
  if (run % 2 === 1) swapBatsmen();

  autoCalc();
  saveData();
}

function saveData() {
  const score = {
    teamA: document.getElementById('teamA').value,
    teamB: document.getElementById('teamB').value,
    runs: +document.getElementById('runs').value,
    wickets: +document.getElementById('wickets').value,
    overs: document.getElementById('overs').value,
    last6: document.getElementById('last6').value,

    batsman1: {
      name: document.getElementById('b1Name').value,
      runs: +document.getElementById('b1Runs').value,
      balls: +document.getElementById('b1Balls').value,
      fours: +document.getElementById('b1Fours').value,
      sixes: +document.getElementById('b1Sixes').value,
      sr: +document.getElementById('b1SR').value
    },
    batsman2: {
      name: document.getElementById('b2Name').value,
      runs: +document.getElementById('b2Runs').value,
      balls: +document.getElementById('b2Balls').value,
      fours: +document.getElementById('b2Fours').value,
      sixes: +document.getElementById('b2Sixes').value,
      sr: +document.getElementById('b2SR').value
    },
    bowler: {
      name: document.getElementById('bowlerName').value,
      overs: document.getElementById('bowlerOvers').value,
      runs: +document.getElementById('bowlerRuns').value,
      wickets: +document.getElementById('bowlerWickets').value,
      eco: +document.getElementById('bowlerEco').value
    },
    target: +document.getElementById('target').value || null,
    targetOvers: +document.getElementById('targetOvers').value || null,
    targetWickets: +document.getElementById('targetWickets').value || null
  };

  fetch("update.php", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ score })
  })
  .then(res => res.json())
  .then(data => console.log("Saved:", data))
  .catch(err => console.error("Error:", err));
}
</script>

<h3>Last 6 Balls</h3>
<input type="text" id="lastBall" placeholder="e.g. 1, 4, 6, W, NB2, LB3">
<button onclick="addLastBall()">Add</button>
<div class="last6-display" id="last6Container"></div>

</body>
</html>
<!-- END OF update.html -->
